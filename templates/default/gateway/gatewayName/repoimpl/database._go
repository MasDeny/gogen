package repoimpl

import (
	"context"
	"sync"

	"{{.PackagePath}}/infrastructure/log"
)

var onceDatabaseImpl sync.Once

var databaseImplObj DatabaseImpl

func SingletonDatabaseImpl(db interface{}) *DatabaseImpl {
	onceDatabaseImpl.Do(func() {
		databaseImplObj = DatabaseImpl{db: db}
	})
	return &databaseImplObj
}

type DatabaseImpl struct{
	db interface{}
}

// GetDatabase put the database object into context.
// From client view, it will return the context to user
func (r *DatabaseImpl) GetDatabase(ctx context.Context) context.Context {
	log.InfoRequest(ctx, "GetDB")

	trxCtx := context.WithValue(ctx, ContextDBValue, r.db)

	log.InfoResponse(ctx, "GetDB")
	return trxCtx
}

// extractDB is used by other repo to extract the database from context
func extractDB(ctx context.Context) (interface{}, error) {

    //	db, ok := ctx.Value(ContextDBValue).(*gorm.DB)
    //  if !ok {
    //	    return nil, errcat.DatabaseNotFoundInContextError
    //  }

	return nil, nil
}